apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: azerothcore
  namespace: gaming
spec:
  interval: 5m
  chart:
    spec:
      chart: app-template
      version: 14.5.3
      sourceRef:
        kind: HelmRepository
        name: truecharts
        namespace: flux-system
  values:
    image:
        repository: acore/ac-wotlk-worldserver
        tag: master
    controller:
        type: deployment
        replicas: ENC[AES256_GCM,data:iQ==,iv:ER0KadJUuI5kvawKmjQUc+tzf2Yzc8rFoahiwzG+BHg=,tag:NUE19GOc0a1snTi+Owwogg==,type:int]
    env:
        # These match the MariaDB container creds
        MYSQL_HOST: mariadb.default.svc.cluster.local
        MYSQL_USER: acore
        MYSQL_PASSWORD: ENC[AES256_GCM,data:um8WK8c=,iv:wZjt5qAL3NhbvNq+zTdkL0rk26nZ7K7vBaJDCrn7WPU=,tag:pCFBjLAoVid+wZfcFs5sXw==,type:str]
        MYSQL_DATABASE: acore
    initContainers: []
    sidecars:
        authserver:
            image: ENC[AES256_GCM,data:YNSMGVBeGFUXpsQ82lDx0m1WaoQZ7LSrt6Gjq7xLUYM=,iv:IEGzZ6YCSJCJ8I07xxb+glHONLHFkRea4r8y6SfWT2s=,tag:AWCZ0vQEryDI1CJ3M7rLRg==,type:str]
            command:
                - ENC[AES256_GCM,data:th6W3AHTbNdEqDhyehylLRvd18ZYUMkajIX8,iv:Fe7B9ZeGcVe7lce5/4n3O/RomDzOI5SkVj6F0sBMnG4=,tag:0fldXzIrakD+WRwFb75YhA==,type:str]
            args: []
            envFrom:
                - secretRef:
                    name: ENC[AES256_GCM,data:n2+gkkH2icqN3A80wQ==,iv:4RixpJMozlNMR4zL9I4T5aK/Oqc7xRgnB/yVJ92qgso=,tag:yBmBYmjnA02qAb9fNnH7iQ==,type:str]
    args:
        - /azerothcore/bin/worldserver
    service:
        main:
            enabled: true
            ports:
                main:
                    port: 8085
                    targetPort: 8085
                    protocol: TCP
    persistence:
        config:
            enabled: true
            mountPath: /azerothcore/etc
            type: nfs
            server: ${NAS_IP}
            path: ${NFS_GAME_SERVERS}/azerothcore
    mariadb:
        enabled: true
        auth:
            rootPassword: ENC[AES256_GCM,data:TezIUw==,iv:1kuuQDWp2VtIz22WMSsRHjM9lCJinOEe/awOmX0xiNg=,tag:Sy6FbUZJkAxxSlKi14U/ng==,type:str]
            username: acore
            password: ENC[AES256_GCM,data:/RU+Xos=,iv:riaQf1Rn2EXoSS5m0ZwGNABf+whwSsBwTmwfgJ8GsZg=,tag:2xGwJb2s+SKObnByDNNwWQ==,type:str]
            database: acore
    sops:
        shamir_threshold: 3
        age:
            - recipient: age1k26ujnyjzw0y2sd72lyayn694luyr9agswjuklrtn8j3a5vseuaqsvruad
              enc: |
                -----BEGIN AGE ENCRYPTED FILE-----
                YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBuM1VGTDdyREp6RTZvV3U0
                OHdHVHdnd2VPSDgyTVFXbS9FMXQyaG16eldrClRwM1cwdkZOZGErMnVGalMxSXdl
                R3VDazI4WWl4Sy9HbU8wNUhWWXkwL1UKLS0tIDBQSVp4SEpMM2hPaHpjeU1ZOUUw
                ajFwbkdxNU1XWmV4MkpJaGZ0UERKSUEKYJiM3xMKtekX4JajWkwnGtkbqdU69R1k
                F5Rm1foSZF0V3jZBHr9OK5wz4hz5KVxqvCjZrVdchD/DrZeE5Zf6dA==
                -----END AGE ENCRYPTED FILE-----
        lastmodified: "2025-05-24T04:10:37Z"
        mac: ENC[AES256_GCM,data:5hPHPwT4iNVF2Z3nRcJGPmV7m5UaMJLF1ghy116xUF4vyfVHCrYQf6HQZDQ34u8v+O5sezELC+cIsuffugE4OD+i3vFachitDkZaXzWFpSEdKbTn0vsaUKtPmkIgsUnmlKSzIEsvGJAuHD4sgdbYXUqbur4qsOqnPAcl0SXss30=,iv:x68RfujLJ16qYJixd9X9fOIWa1Zs7PU/jP8+lbOPITQ=,tag:j9z9enTer67Efc3oNecf3w==,type:str]
        encrypted_regex: ((?i)(displayname|email|pass|ca|id|bootstraptoken|secretboxencryptionsecret|secrets|secrets|password|cert|secret($|[^N])|key|token|^data$|^stringData))
        version: 3.10.1
