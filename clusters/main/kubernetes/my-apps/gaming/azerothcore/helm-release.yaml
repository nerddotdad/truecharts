apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: azerothcore
  namespace: gaming
spec:
  interval: 5m
  chart:
    spec:
      chart: app-template
      version: 14.5.3
      sourceRef:
        kind: HelmRepository
        name: truecharts
        namespace: flux-system
  values:
    image:
      repository: acore/ac-wotlk-worldserver
      tag: master

    controller:
      type: deployment
      replicas: 1

    env:
      # These match the MariaDB container creds
      MYSQL_HOST: "mariadb.default.svc.cluster.local"
      MYSQL_USER: "acore"
      MYSQL_PASSWORD: "acore"
      MYSQL_DATABASE: "acore"

    initContainers: []
    sidecars:
      authserver:
        image: acore/ac-wotlk-authserver:master
        command:
          - /azerothcore/bin/authserver
        args: []
        envFrom:
          - secretRef:
              name: mariadb-creds

    args:
      - /azerothcore/bin/worldserver

    service:
      main:
        enabled: true
        ports:
          main:
            port: 8085
            targetPort: 8085
            protocol: tcp

    persistence:
        config:
            enabled: true
            mountPath: /azerothcore/etc
            type: nfs
            server: ${NAS_IP}
            path: ${NFS_GAME_SERVERS}/azerothcore
            
    mariadb:
      enabled: true
      auth:
        rootPassword: root
        username: acore
        password: acore
        database: acore